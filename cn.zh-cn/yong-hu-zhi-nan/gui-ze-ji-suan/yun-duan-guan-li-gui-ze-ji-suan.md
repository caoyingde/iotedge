# 云端管理规则计算

## 开通规则计算服务 <a id="section_hvr_prq_32b .section"></a>

如果您还未开通规则计算服务，需先开通。

开通服务步骤：

1. 登录[物联网平台控制台](https://iot.console.aliyun.com/)。
2. 单击左侧导航栏中的**扩展服务** &gt; **服务管理**。
3. 在扩展服务页面，单击**规则计算**，进入服务详情页。

   ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15098/15408903186569_zh-CN.png)

4. 单击**开通服务**。

   ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15098/15408903186570_zh-CN.png)

5. 单击**使用服务**。

   ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15098/15408903186571_zh-CN.png)

## 创建规则 <a id="section_vht_prq_32b .section"></a>

开通服务后，便可在控制台创建规则。

1. 单击[物联网平台控制台](http://iot.console.aliyun.com)左侧导航栏中的**扩展服务** &gt; **规则计算**。
2. 单击**新增规则计算**。

   ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15098/15408903186572_zh-CN.png)

3. 设置具体规则，然后单击**保存**。
4. 在创建的规则名称右侧单击**编辑**，编辑规则计算。

   以空调设备自动化为例：在 12:00 至 23:59 之间，当温度传感器上报的室内温度高于1摄氏度时，空调设备执行控制室内温度为10摄氏度。

   具体规则设置，请见下图。

   ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15098/15408903196573_zh-CN.png)

   * **规则名称**：自定义的规则名称。
   * **触发条件**：即规则入口。可设置为**设备触发**或**定时触发**。当设备上报的数据或当前时间满足设定的触发条件时，则触发过滤条件判断。可以为一个规则创建多个触发条件，触发条件之间是或（or）关系。
     * 设置为**设备触发**，则需选择已创建的产品名称、设备名称、和设备功能中的属性或事件（仅支持高级版设备）。
     * 设置为**定时触发**，则需填写时间点。时间点格式为 cron 表达式。cron表达式的构成：分、小时、日、月、一周内的某天（0或7表示周日，1-6分别表示周一至周六），每项之间用空格隔开。如，每天18点整的cron表达式为：0 18 \* \* \*（其中星号（\*）是通配符）；每周五18点整的表达式为：0 18 \* \* 5。cron 表达式具体写作方法，请参见 [CRONTAB 网页](http://crontab.org/)。

       上图示例中，设置为**设备触发**：以温度传感器上报的室内温度高于1摄氏度作为触发条件。
   * **过滤条件**：过滤条件集。只有满足过滤条件的数据，才能触发执行动作。可设置为**设备过滤**或**时间过滤**。可以为一个规则创建多个过滤条件，过滤条件之间是和（and）关系。
     * 设置为**设备过滤**，则需选择已创建的产品名称、设备名称、和设备功能中的属性或事件（仅支持高级版设备）。
     * 设置为**时间过滤**，则需设置起始时间和结束时间。

       上图示例中，设置为**时间过滤**：时间在 12:00 至 23:59 之间，则触发执行动作。
   * **执行动作**：需执行的动作。可设置为**设备输出**或**规则输出**。您可以设置多个动作。某一动作执行失败时，不影响其他动作。
     * 设置为**设备输出**，则需选择已创建的产品名称、设备名称、和设备功能中的属性或服务（仅支持高级版设备，并且只有可写的属性或服务才能被设为执行动作）。当触发条件和过滤条件均被满足时，执行已定义的设备属性或服务的相关动作。
     * 设置为**规则输出**，则需嵌套另外一个规则，即调用其他规则。被调用的规则中的触发条件将被跳过，直接进行过滤条件检查。若过滤条件满足，则执行该规则中定义的执行动作。

       上图示例中，设置为**设备输出**：指定的空调设备执行控制温度为10摄氏度。

## 运行规则 <a id="section_jz4_4rq_32b .section"></a>

规则创建成功后，您可在规则计算页面中，启动此规则。只有启动状态的规则才能在云端运行。

启动规则操作：

1. 单击[物联网平台控制台](http://iot.console.aliyun.com)左侧导航栏中**规则计算**。
2. 找到要启动的规则，将规则设置为**启动**状态。

规则设置为启动状态后，当设备有数据上报，并且上报数据满足触发条件时，该规则便会在云端运行。

若要使规则在边缘分组节点中运行，您需将规则部署到分组中。具体操作，请参见[边缘实例规则计算](https://github.com/caoyingde/iotedge/tree/c697ce413860528d62c9113f91fb2ceb706e7d24/cn.zh-CN/用户指南/规则计算/cn.zh-CN/用户指南/规则计算/边缘实例规则计算.md)。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15098/15408903196574_zh-CN.png)

## 查看日志 <a id="section_r2b_drq_32b .section"></a>

您可以查看该规则的日志，并且可在详情中查看运行结果。

**说明：** 若某条规则即既云端运行又在边缘端运行，那么在物联网平台控制台规则计算中，查看到的日志为云端运行日志和边缘端运行日志。

1. 单击[物联网平台控制台](http://iot.console.aliyun.com)左侧导航栏中**规则计算**。
2. 找到要查看日志的规则，单击操作栏中的**日志**按钮。

   ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15100/15408903196700_zh-CN.jpg)

3. 单击**详情**，查看该条日志的详情信息。

   ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15098/15408903196575_zh-CN.png)

